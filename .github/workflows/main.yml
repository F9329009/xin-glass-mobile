# å·¥ä½œæµåç§°ï¼Œä¸è®¾ç½®çš„è¯é»˜è®¤å–é…ç½®æ–‡ä»¶å
name: GitHub Actions Deploy xin-glass-mobile main
# æŒ‡å®šè§¦å‘ workflow çš„æ¡ä»¶
# æŒ‡å®šè§¦å‘äº‹ä»¶æ—¶ï¼Œå¯ä»¥é™å®šåˆ†æ”¯æˆ–æ ‡ç­¾
# å½“å‰æ˜¯ åªæœ‰ main åˆ†æ”¯ä¸Šè§¦å‘ push äº‹ä»¶æ—¶æ‰æ‰§è¡Œå·¥ä½œæµä»»åŠ¡
on:
  push:
    branches:
      - main
# å·¥ä½œæµæ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡
jobs:
  # ä»»åŠ¡åç§°
  build:
    # ä»»åŠ¡è¿è¡Œçš„å®¹å™¨ç±»å‹ï¼ˆè™šæ‹Ÿæœºç¯å¢ƒï¼‰
    runs-on: ubuntu-latest
    # åˆ¤æ–­åœ¨æŒ‡å®šç”¨æˆ·æˆ–è€…ç»„ç»‡çš„æŒ‡å®šä»“åº“ä¸­æ‰æ‰§è¡Œ
    if: github.repository == 'F9329009/xin-glass-mobile'
    # åˆ¤æ–­åœ¨æŒ‡å®šç»„ç»‡ä¸­æ‰æ‰§è¡Œ
    # if: github.repository_owner == 'ç»„ç»‡å'
    # ä»»åŠ¡æ‰§è¡Œçš„æ­¥éª¤
    steps:
      # åˆ‡æ¢åˆ†æ”¯
      - name: Checkout ğŸ›ï¸
        # ä½¿ç”¨çš„æ“ä½œ actionsï¼Œå¯ä»¥ä½¿ç”¨å…¬å…±ä»“åº“ï¼Œæœ¬åœ°ä»“åº“ï¼Œåˆ«äººçš„ä»“åº“çš„action
        # æ‹‰å–ä»£ç 
        uses: actions/checkout@v2.3.1
        with:
          persist-credentials: false

      # ä¸‹è½½ä¾èµ–å¹¶ç¼–è¯‘
      - name: npm install and build ğŸ”§
        # æ‰§è¡Œä¸‹è½½å’Œç¼–è¯‘å‘½ä»¤
        run: |
          npm install
          npm run build
        env:
          CI: true

      # éƒ¨ç½²
      - name: Deploy ğŸš€
        # æ„å»º
        uses: easingthemes/ssh-deploy@v2.1.5
        # è¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡
        env:
          # æœåŠ¡å™¨SSHå…å¯†ç™»é™†ç§˜é’¥
          SSH_PRIVATE_KEY: ${{ secrets.ACCESS_TOKEN }}
          # --delete å‚æ•°è¡¨ç¤ºå…ˆåˆ é™¤éƒ¨ç½²è·¯å¾„çš„æ‰€æœ‰æ–‡ä»¶
          ARGS: "-rltgoDzvO"
          # React é»˜è®¤æ‰“åŒ…åˆ° build ç›®å½•
          SOURCE: "build/"
          # æœåŠ¡å™¨åœ°å€(IPæˆ–è€…åŸŸå)
          REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
          # æœåŠ¡å™¨ç”¨æˆ·å
          REMOTE_USER: ${{ secrets.REMOTE_USER }}
          # æœåŠ¡å™¨ç½‘ç«™çš„éƒ¨ç½²è·¯å¾„
          TARGET: ${{ secrets.REMOTE_TARGET }}
